trigger:
  - main

pool:
  name: 'Default'

variables:
  - group: docker-creds
  - group: image-cred

stages:
  - stage: Sonarcube
    displayName: Sonarcube login
    jobs:
      - job: 
        steps:
        - task: SonarQubePrepare@7
          inputs:
            SonarQube: 'sonarqube'
            scannerMode: 'cli'
            configMode: 'manual'
            cliProjectKey: 'laravel'
            cliProjectName: 'laravel'
            cliSources: '.'
        - task: SonarQubeAnalyze@7
          displayName: 'Run SonarQube Scanner'
        - task: SonarQubePublish@7
          inputs:
            pollingTimeoutSec: '300'

  - stage: DockerLogin
    displayName: Docker Login
    jobs:
      - job: DockerLogin
        steps: 
          - script: |
              echo "$(DOCKER_PASSWORD)" | docker login -u "$(DOCKER_USERNAME)" --password-stdin
            displayName: 'Docker Login'

